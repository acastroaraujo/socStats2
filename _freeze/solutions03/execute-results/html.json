{
  "hash": "cdedca3aafb3c332773427d75d91ad37",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Solutions 3\"\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Packages et al.\"}\nlibrary(tidyverse)\ntheme_set(theme_light(base_family = \"Optima\"))\n```\n:::\n\n\n## Exercise\n\n| Group ($T$) |  $E[Y^1]$  | $E[Y^0]$  |\n|:-----------:|:----------:|:---------:|\n|   $T = 1$   |   10,000   | **5,000** |\n|   $T = 0$   | **10,000** |   5,000   |\n\nThe missing cells are like this because of the ignorability assumption in a perfectly executed experiment.\n\nATE: 5,000\n\n## Exercise\n\n*Draw a causal diagram for the research question \"do long shift hours make doctors give lower-quality care?\" that incorporates the following features (and only the following features):*\n\na.  *Long shift hours affect both how tired doctors are, and how much experience they have, both of which affect the quality of care*\n\nb.  *How long shifts are is often decided by the hospital the doctor works at. There are plenty of other things about a given hospital that also affect the quality of care, like its funding level, how crowded it is, and so on*\n\nc.  *New policies that reduce shift times may be implemented at the same time (with the timing determined by some unobservable change in policy preferences) as other policies that also attempt to improve the quality of care*\n\n![](images/te-7.2.png){fig-align=\"center\" width=\"70%\"}\n\n## Exercise\n\nConsider this research question: Does the funding level of public schools affect student achievement for students in your country?\n\na.  **What is the treatment and what is the outcome of interest?**\n\n    *Outcome: student achievement. Treatment: funding level.*\n\nb.  **Write down a list of relevant variables.**\n\n    *Relevant variables: government budget, student SES, class size, staff salary, other social welfare policies.*\n\nc.  **Which of the variables in your list in part b are causes of both treatment and outcome?**\n\n    *Government budget*\n\nd.  **Why might we want to pay extra attention to the variables listed in part c?**\n\n    *Because they are confounders*\n\ne.  **Draw a causal diagram of the variables listed in part b.**\n\n    ![](images/clipboard-645414427.png){width=\"80%\"}\n\nf.  **Simplify the diagram from part e.**\n\n    ![](images/clipboard-2197633242.png){width=\"80%\"}\n\n## Exercise\n\n*How can a causal diagram be modified so as to avoid cyclic relationships?*\n\n*Consider the diagram below. It depicts a cyclical relationship between student achievement and motivation. If students achieve more (i.e., score well on exams), then their motivation goes up, and if their motivation goes up, they achieve more. Change the diagram so that the relationship is not cyclic anymore.*\n\n$$\n\\text{Student Achievement} \\longleftrightarrow \\text{Motivation}\n$$\n\n**Possible answer:**\n\n![](images/clipboard-321003852.png){fig-align=\"center\" width=\"50%\"}\n\n## Exercise\n\n*Assuming that a path has no colliders on it, what is the difference between a path being Open and Closed?*\n\n**At least one of the variables in the path has been adjusted for—i.e., variation is removed or \"controlled\" for.**\n\n*Note. Remember that you'll always sound smarter if you say \"adjusted\" instead of \"controlled\" in the context of regression with observational data.*\n\n## Exercise\n\nConsider the below generic causal diagram.\n\n![](images/te-8.2.png){fig-align=\"center\" width=\"60%\"}\n\na.  **List every path from X to Y.**\n\n    $$\n    \\begin{align}\n    &1. &&X \\to A \\to Y, \\\\\n    &2. &&X \\leftarrow B \\to Y, \\\\\n    &3. &&X \\leftarrow B \\leftarrow D \\to Y, \\\\\n    &4. &&X \\to C \\leftarrow D \\to Y, \\\\\n    &5. &&X \\to C \\leftarrow D \\to B \\to Y\n    \\end{align}\n    $$\n\nb.  **Which of the paths are front-door paths?**\n\n    1\n\nc.  **Which of the paths are open back-door paths?**\n\n    2 and 3\n\nd.  **What variables must be controlled for in order to identify the effect of X on Y? (only list what must be controlled for, not anything that additionally could be controlled for).**\n\n    $B$\n\n## Exercise\n\nWhich of the following describes a causal path where all the arrows point away from the treatment?\n\na.  Open Path\n\nb.  Closed Path\n\nc.  **Front Door Path (this one)**\n\nd.  Back Door Path\n\n## Exercise\n\n*Consider the figure below, which depicts the relationship between teaching quality, number of publications (e.g., articles, books), and popularity among scholars and students in a population of professors.*\n\n![](images/te-8.5.png){fig-align=\"center\" width=\"60%\"}\n\na.  *What type of variable is Popularity in one path on this diagram?*\n\nb.  *Discuss what would happen if you controlled for Popularity.*\n\n**Popularity is a collider variable. If we \"control\" (remove variation) for Popularity we will artificially create a negative association between Teaching Quality and Number of Publications**\n\n## Exercise\n\n*Go to the app Steve showed us in class.*\n\n[*https://cbdrh.shinyapps.io/daggle/*](https://cbdrh.shinyapps.io/daggle/){.uri}\n\n*Spend some time noodling around with it and upload screenshots with the right answer for three DAGs with 4, 6, and 8 nodes each. Set the complexity to \"difficult.\"*\n\n**Grading based is conditional on screenshots.**\n\n## Exercise\n\n*House of DAG Simulation.*\n\nI've included a [little script](https://github.com/acastroaraujo/socStats2/blob/main/hod_simulation_functions.R) with a couple of functions meant to illustrate the connection between DAGs and the estimands we saw in class (ATE, ATT, ATC).\n\nSave it to your project and load it using the `source()` function.\n\nYou should see a function called `hod_simulation()` which creates a dataset that corresponds to the following DAG:\n\n::: grid\n::: g-col-7\n![](images/house-of-dag.png){width=\"100%\"}\n:::\n\n::: g-col-5\n-   $Y$: outcome\n-   $T$: treatment\n-   $U$: unobserved confounder\n-   $S$: affects selection into $T$\n-   $X$: affects $Y$ directly\n:::\n:::\n\nThe `hod_simulation()` function has the following arguments:\n\n-   `N`: Sample Size\n\n-   `rho`: The correlation between $S$ and $X$, it accepts values between -1 and 1.\n\n-   `Bt`: this is the treatment effect.\n\n-   `Bx`: this is the direct effect of $X$ on $Y$\n\nThis is the dataset it creates:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(\"hod_simulation_functions.R\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error ~  0.322 \nPower ~  0.873# A tibble: 4 × 3\n  variable    sd  mean\n  <chr>    <dbl> <dbl>\n1 y        5.23  1.53 \n2 t        0.500 0.493\n3 x        1.02  0.999\n4 s        0.985 1.00 \n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(12345) ## include this so that grading is easier for me.\nd <- hod_simulation(N = 1e3, Bt = 2, Bx = 4, rho = 0.8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error ~  0.405 \nPower ~  0.999# A tibble: 4 × 3\n  variable    sd  mean\n  <chr>    <dbl> <dbl>\n1 y        6.75   4.98\n2 t        0.500  0.52\n3 x        1.02   1.00\n4 s        1.01   1.02\n```\n\n\n:::\n:::\n\n\n*Note. Ignore the \"Standard Error\" and \"Power\" messages.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,000\nColumns: 6\n$ y0 <dbl> 3.0258462, 5.2008689, -0.3510375, -2.7643240, -3.7947830, 12.879242…\n$ y1 <dbl> 5.0258462, 7.2008689, 1.6489625, -0.7643240, -1.7947830, 14.8792426…\n$ t  <int> 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1…\n$ y  <dbl> 5.0258462, 7.2008689, 1.6489625, -0.7643240, -3.7947830, 12.8792426…\n$ x  <dbl> 1.89642215, 0.54549787, -0.35506814, 1.03476207, 0.05065330, 2.5734…\n$ s  <dbl> 1.84099574, 0.69942604, 0.72890759, 1.44006399, 0.33470650, 1.70875…\n```\n\n\n:::\n:::\n\n\n**Without looking at the results just yet... do you think the naive estimate will be larger or smaller than the \"real\" estimate (** $ATE = 2$ **)?**\n\nThe results should be larger because people who get the treatment should also a higher $X$, and the effect of $X$ is positive.\n\n**Check your answer. What are the results given by the naive estimator?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd |> \n  group_by(t) |> \n  summarize(across(c(y0, y1), mean))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n      t    y0    y1\n  <int> <dbl> <dbl>\n1     0  2.00  4.00\n2     1  5.72  7.72\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(d$y[d$t == 1]) - mean(d$y[d$t == 0])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5.718145\n```\n\n\n:::\n:::\n\n\n**Re-do this but set `rho` to -0.8 (so that** $S$ **and** $X$ **are now negatively correlated).**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- hod_simulation(N = 1e3, Bt = 2, Bx = 4, rho = -0.8)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard Error ~  0.405 \nPower ~  0.999\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(variable)`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 3\n  variable    sd  mean\n  <chr>    <dbl> <dbl>\n1 y        6.35  4.89 \n2 t        0.500 0.512\n3 x        0.992 0.962\n4 s        1.00  1.03 \n```\n\n\n:::\n\n```{.r .cell-code}\nd |> \n  group_by(t) |> \n  summarize(across(c(y0, y1), mean))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n      t    y0    y1\n  <int> <dbl> <dbl>\n1     0  5.70  7.70\n2     1  2.12  4.12\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(d$y[d$t == 1]) - mean(d$y[d$t == 0])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -1.576179\n```\n\n\n:::\n:::\n\n\n*Note. You should have been able to figure out that the \"naive estimator\" (difference between groups) was going to be biased in the opposite side (i.e., smaller or even negative).*\n\n## Exercise\n\n**Take the dataset `d` created in the previous question and modify it so that the treatment is now randomized (this will destroy the path between** $S$ **and** $T$**).**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd$t <- sample(d$t)\nd$y <- ifelse(as.logical(d$t), d$y1, d$y0)\n```\n:::\n\n\n**Without looking at the results just yet... do you think the naive estimate will be larger or smaller than the \"real\" estimate (** $ATE = 2$ **)?**\n\nThe answers should be roughly the same as the \"real\" estimate because we have effectively destroyed the backdoor path via the randomization of the treatment. But there's still margin for sampling error, so we should also look at the standard error.\n\n**Check your answer. What are the results given by the naive estimator?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(d$y[d$t == 1]) - mean(d$y[d$t == 0])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.537577\n```\n\n\n:::\n:::\n\n\n**Use `lm()` to predict the newly created `y` from `t`. What are the coefficient values?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ t, data = d) |> \n  broom::tidy(conf.int = TRUE) ## 95% confidence interval\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 7\n  term        estimate std.error statistic  p.value conf.low conf.high\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>    <dbl>     <dbl>\n1 (Intercept)     4.11     0.297     13.8  5.15e-40    3.52       4.69\n2 t               1.54     0.414      3.71 2.18e- 4    0.724      2.35\n```\n\n\n:::\n:::\n\n\n**Use `lm()` to predict the newly created `y` from `t` and `x`. What are the coefficient values?**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlm(y ~ t + x, data = d) |> \n  broom::tidy(conf.int = TRUE) ## 95% confidence interval\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 7\n  term        estimate std.error statistic   p.value conf.low conf.high\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>    <dbl>     <dbl>\n1 (Intercept)    0.197     0.281     0.703 4.82e-  1   -0.354     0.748\n2 t              1.49      0.325     4.57  5.53e-  6    0.848     2.13 \n3 x              4.09      0.164    24.9   6.09e-107    3.77      4.41 \n```\n\n\n:::\n:::\n\n\n*Note that in both of these cases the estimate was correctly \"identified\" (from a causal inference perspective) but the second answer is closer to the \"truth.\" Look at the standard errors, they are smaller!*\n",
    "supporting": [
      "solutions03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}