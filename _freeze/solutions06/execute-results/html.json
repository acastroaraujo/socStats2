{
  "hash": "b0180461501318fd1e5538aad2f1f6c7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Solutions 6\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\n```\n:::\n\n\n## Exercise\n\nReplicate balance plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- haven::read_dta(\"data/cattaneo2.dta\")\n\nd <- d |>  \n  haven::zap_labels() |>             \n  select(bweight, lbweight, mbsmoke, mmarried, \n         mage, medu, fbaby, alcohol, mrace, nprenatal)\n\nglimpse(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,642\nColumns: 10\n$ bweight   <dbl> 3459, 3260, 3572, 2948, 2410, 3147, 3799, 3629, 2835, 3880, …\n$ lbweight  <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, …\n$ mbsmoke   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, …\n$ mmarried  <dbl> 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, …\n$ mage      <dbl> 24, 20, 22, 26, 20, 27, 27, 24, 21, 30, 26, 20, 34, 21, 23, …\n$ medu      <dbl> 14, 10, 9, 12, 12, 12, 12, 12, 12, 15, 12, 12, 14, 8, 12, 12…\n$ fbaby     <dbl> 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, …\n$ alcohol   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ mrace     <dbl> 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, …\n$ nprenatal <dbl> 10, 6, 10, 10, 12, 9, 16, 11, 20, 9, 14, 5, 13, 8, 4, 10, 13…\n```\n\n\n:::\n\n```{.r .cell-code}\nd |> \n  select(!matches(\"weight\")) |> \n  pivot_longer(!mbsmoke, names_to = \"covariate\") |> \n  group_by(mbsmoke, covariate) |> \n  summarize(avg = mean(value), sd = sd(value)) |> \n  pivot_wider(names_from = mbsmoke, values_from = c(avg, sd)) |> \n  mutate(diff = (avg_1 - avg_0) / sd_1) |> \n  mutate(sign = factor(sign(diff), labels = c(\"negative\", \"positive\"))) |> \n  mutate(covariate = fct_reorder(covariate, abs(diff))) |> \n  ggplot(aes(x = diff, y = covariate)) +\n  geom_segment(aes(xend = diff, yend = covariate), x = 0) +\n  geom_point(fill = \"white\", shape = 21) +\n  geom_vline(xintercept = 0, linetype = \"dashed\") +\n  coord_cartesian(xlim = c(-0.6, 0.6)) +\n  labs(y = NULL, x = \"Standardized Differences in Means\", \n       title = \"Imbalance in averages of confounding covariates across treatment groups\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'mbsmoke'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](solutions06_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(\n#   plot = last_plot(),\n#   filename = \"images/imbalance_plot_example.png\", \n#   device = \"png\", \n#   dpi = \"print\", \n#   height = 5, \n#   width = 7\n# )\n```\n:::\n\n\n## Exercise\n\n*This question is copied from NHK's exercises. To answer this question you need to read sections 14.1 and 14.2 of [The Effect](https://theeffectbook.net/).*\n\n*You want to know whether practicing cursive improves your penmanship (on a 1-10 scale). You find that, among people who don’t practice cursive, average penmanship is 5, 10 people are left-handed, 2 are ambidextrous, and 88 are right-handed. Among people who do practice cursive, 6 are left-handed with average penmanship 7, 4 are ambidextrous with average penmanship 4, and 90 are right-handed with average penmanship 6.*\n\nYou should probably represent the data in a better format, like this:\n\n+----------------------+----------------------+----------------------+\n|                      | Cursive (Treatment)  | No Cursive (Control) |\n+======================+:====================:+:====================:+\n| Left-handed          | Avg = 7              | Avg = ?              |\n|                      |                      |                      |\n|                      | N = 6                | N = 10               |\n+----------------------+----------------------+----------------------+\n| Right-handed         | Avg = 6              | Avg = ?              |\n|                      |                      |                      |\n|                      | N = 90               | N = 88               |\n+----------------------+----------------------+----------------------+\n| Ambidextrous         | Avg = 4              | Avg = ?              |\n|                      |                      |                      |\n|                      | N = 4                | N = 2                |\n+----------------------+----------------------+----------------------+\n| Total                | Avg = ?              | Avg = 5              |\n|                      |                      |                      |\n|                      | N = 100              | N = 100              |\n+----------------------+----------------------+----------------------+\n\n### Part A\n\n> You want to create a set of weights that will *make the treated group match the control group on handedness*. Follow the process in [section 14.2](https://theeffectbook.net/ch-Matching.html#weighted-averages), paying attention to *why* certain numbers are going in certain positions. What weights will be given to the left, ambidextrous, and right-handed people *in the control group*?\n\nSince you want to make the treated group match the control group, all three weights for the control group are simply 1.\n\n### Part B\n\n> What weights will be given to the left, ambidextrous, and right-handed people *in the treated group*?\n\n+-----------------+----------------------+------------------------------------+\n|                 | Cursive (Treatment)  | Weights                            |\n+=================+:====================:+:==================================:+\n| Left-handed     | Avg = 7              | $$ \\frac{10}{6} \\approx 1.6667 $$  |\n|                 |                      |                                    |\n|                 | N = 6                |                                    |\n+-----------------+----------------------+------------------------------------+\n| Right-handed    | Avg = 6              | $$ \\frac{88}{90} \\approx 0.9778 $$ |\n|                 |                      |                                    |\n|                 | N = 90               |                                    |\n+-----------------+----------------------+------------------------------------+\n| Ambidextrous    | Avg = 4              | $$ \\frac{2}{4} = 0.5 $$            |\n|                 |                      |                                    |\n|                 | N = 4                |                                    |\n+-----------------+----------------------+------------------------------------+\n| Total           | Avg = ?              |                                    |\n|                 |                      |                                    |\n|                 | N = 100              |                                    |\n+-----------------+----------------------+------------------------------------+\n\n### Part C\n\n> Use the weights from part b to calculate the *proportion of left-handed people in the treated group*, as well as the proportion of ambidextrous people and the proportion of right-handed people. If you don’t get 10%, 2%, and 88% (or very close with some rounding error), your weights are wrong, try again.\n\n+------------------+---------------------+------------------------------------+--------------+\n|                  | Cursive (Treatment) | Weights                            | Proportion   |\n+==================+:===================:+:==================================:+:============:+\n| Left-handed      | Avg = 7             | $$ \\frac{10}{6} \\approx 1.6667 $$  | $$           |\n|                  |                     |                                    | 0.1          |\n|                  | N = 6               |                                    | $$           |\n+------------------+---------------------+------------------------------------+--------------+\n| Right-handed     | Avg = 6             | $$ \\frac{88}{90} \\approx 0.9778 $$ | $$           |\n|                  |                     |                                    | 0.88         |\n|                  | N = 90              |                                    | $$           |\n+------------------+---------------------+------------------------------------+--------------+\n| Ambidextrous     | Avg = 4             | $$ \\frac{2}{4} = 0.5 $$            | $$           |\n|                  |                     |                                    | 0.02         |\n|                  | N = 4               |                                    | $$           |\n+------------------+---------------------+------------------------------------+--------------+\n| Total            | Avg = ?             |                                    | Prop = 1     |\n|                  |                     |                                    |              |\n|                  | N = 100             |                                    |              |\n+------------------+---------------------+------------------------------------+--------------+\n\nSource:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(10/6) * (6 / 100) ## LH\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.1\n```\n\n\n:::\n\n```{.r .cell-code}\n(88/90) * (90/100) ## RH\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.88\n```\n\n\n:::\n\n```{.r .cell-code}\n(1/2) * (4/100)    ## Am\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.02\n```\n\n\n:::\n:::\n\n\n### Part D\n\n> What is the weighted average penmanship score in the treated group?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nw <- c(\"LH\" = (10/6) * (6 / 100), \"RH\" = (88/90) * (90/100) , \"Am\" = (1/2) * (4/100))\nw\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  LH   RH   Am \n0.10 0.88 0.02 \n```\n\n\n:::\n\n```{.r .cell-code}\nweighted.mean(c(7, 6, 4), w)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 6.06\n```\n\n\n:::\n:::\n\n\n### Part E\n\n> What is the effect of practicing cursive that we would estimate using this data?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Non-Weighted Effect\nweighted.mean(c(7, 6, 4), c(6, 90, 4) / 100) - 5\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.98\n```\n\n\n:::\n\n```{.r .cell-code}\n## Weighted Effect\nweighted.mean(c(7, 6, 4), w) - 5\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.06\n```\n\n\n:::\n:::\n\n\n## A Lesson in Simulation\n\n*Note. I will upload a fully worked out simulation learning experience when I get the time...*\n\nLast week I was going to have you re-do something I found in @gelman2020 [pp. 385] that's supposed to build intuition about omitted variable bias and then compare it with results from simulations.\n\n![](images/clipboard-874638397.png){fig-align=\"center\" width=\"90%\"}\n\nIt seems simple at first, but it's also misleading.\n\nSo, I changed things up a bit and added a simple toy DAG:\n\n::: grid\n::: g-col-4\n![](images/clipboard-133306100.png){fig-align=\"center\" width=\"100%\"}\n:::\n\n::: g-col-8\n$$\n\\begin{align}\n&(1) &y_i &= \\beta_0 + \\beta_1 x_i + \\beta_2 w_i + \\varepsilon_i, \n&& \\varepsilon_i \\sim \\text{Normal}(0, \\sigma_y^2) \\\\\\\\\n&(2) &x_i &= \\alpha_0 + \\alpha_1 w_i + u_i, && u_i \\sim \\text{Normal}(0, \\sigma_x^2)\n\\\\\\\\ &&&&&w_i \\sim \\text{Normal}(0, \\sigma_w^2)\n\\end{align}\n$$\n:::\n:::\n\n::: callout-tip\nI expressed Equation (2) so that it would make sense to *generate* data from a simulation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfork_simulation <- function(N = 1e5, a0 = 1, a1 = 1, b0 = 1, b1 = 1, b2 = 1) {\n  \n  tibble(\n    w = rnorm(N, 0, 20),\n    x = a0 + a1*w + rnorm(N, 0, 2),\n    y = b0 + b1*x + b2*w + rnorm(N, 0, 2)\n  )\n  \n}\n```\n:::\n\n:::\n",
    "supporting": [
      "solutions06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}