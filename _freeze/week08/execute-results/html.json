{
  "hash": "2a5569c81286106a75e0884ead810f38",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Week 8\"\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Packages and Set up\"}\nlibrary(tidyverse)\nlibrary(WeightIt)\nlibrary(cobalt)\n```\n:::\n\n\n## Evaluating a child care program\n\nThis dataset is taken from @gelman2020. The dataset contains measurements on the development of nearly 4500 children born in the 1980s.\n\n> A subset of 290 of these children received special services in the first few years of life, including high-quality child care (five full days a week) in the second and third years of life as part of a formal intervention, the Infant Health and Development Program (IHDP). These children were targeted because they were born prematurely, had low birth weight (less than or equal to 2500 grams), and lived in the eight cities where the intervention took place. Children in the sample who did not receive the intervention exhibited a more representative range of birth timing and birth weight.\n>\n> We want to evaluate the impact of this intervention on the children’s subsequent cognitive outcomes by comparing the outcomes for children in the intervention group to the outcomes in a comparison group of 4091 children who did not participate in the program. The outcome of interest is test score at age 3; this test is similar to an IQ measure, so we simplistically refer to these scores as IQ scores from now on.\n>\n> pp. 394-5\n\n*Note. We should all be grateful for Noah Greifer's WeightIt package. You should skim this [website](https://avehtari.github.io/ROS-Examples/Childcare/childcare.html) to get a sense of how the R code for this kind of analysis used to look like in the old days!*\n\nThe **outcome** variable will be `ppvtr.36` (which simply means \"test score at age 3\").[^week08-1]\n\n[^week08-1]: It's not an IQ test, wtf.\n\nHere is the data dictionary:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndict_url <- \"https://raw.githubusercontent.com/avehtari/ROS-Examples/master/Childcare/data/datadict.txt\"\n\nread_file(dict_url) |> \n  writeLines()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nData Dictionary for Child Care example\n\nThe IHDP intervention was implemented in the 1980’s and targeted low\nbirth weight (less than 2500 grams), pre-term children.  They were\nrecruited at the time of birth.  It provided high quality child care\nand other services in their first 3 years of life.  The comparison\ngroup was pulled from a survey conducted during the same time period\ncalled the National Survey of Longitudinal Youth.  At the time of the\nintervention many of the original survey participants (first recruited\nin 1979) had children. We have data from those children and their\nmothers for an overlapping set of variables (below) as the IHDP\nchildren.\n\nThe intervention for low-birth-weight children is described by\n- Brooks-Gunn, J., Liaw, F. R., and Klebanov, P. K. (1992). Effects of\n  early intervention on cognitive function of low birth weight preterm\n  infants. Journal of Pediatrics 120, 350–359.\n- Hill, J. L., Brooks-Gunn, J., and Waldfogel, J. (2003). Sustained\n  effects of high participation in an early intervention for\n  low-birth-weight premature infants. Developmental Psychology 39,\n  730–744.\n\nData columns\n\n\"momage\"   \nmom age at time of birth\n\n\"b.marr\"   \nindicator for whether mom was married at birth\n\n\"momed\"    \nmother’s education level at the time she gave birth\n\n\"work.dur\" \nindicator for whether mom worked in the year before she gave birth\n\n\"prenatal\" \nindicator for whether mom received prenatal care\n\n\"cig\"     \n indicator for whether mom smoked cigarettes while pregnant\n\n\"booze\"    \nindicator for whether mom drank alcohol while pregnant\n\n\"sex\"      \nindicator for whether child was born male or female\n\n\"first\"    \nindicator for whether child was the first born for the mother\n\n\"bw\"       \nchild’s birth weight\n\n\"bwg\"      \nindicator for whether child was born low birth weight\n\n\"preterm\" \nnumber of weeks preterm child was born\n\n\"black\", \"hispanic\", \"white\"    \nindicators for child’s race/ethnicity\n\n\"lths\", \"hs\", \"ltcoll\", \"college\"  \nindicators for mother’s education at time of birth\n\n\"dayskidh\" \nnumber of days child was in the hospital after being born\n\n\"st5\", \"st9\", \"st12\", \"st25\", \"st36\", \"st42\", \"st48\", \"st53\"    \nindicator for state where household resides \n\n\"st99\"  \nindicator for whether family  was living in state served by the ihdp\n\n\"income\"   \nfamily income one year after the child was born\n\n\"treat\"   \nindicator for whether family was allowed to receive IHDP services (1 = yes) \n\n\"ppvtr.36\"\nIQ measured at age 36 months\n```\n\n\n:::\n:::\n\n\nAnd here is the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvar_names <- c(\"momage\", \"b.marr\", \"momed\", \"work.dur\", \"prenatal\", \"cig\", \"booze\", \"sex\", \"first\", \"bw\", \"bwg\", \"preterm\", \"black\", \"hispanic\", \"white\", \"lths\", \"hs\", \"ltcoll\", \"college\", \"dayskidh\", \"st5\", \"st9\", \"st12\", \"st25\", \"st36\", \"st42\", \"st48\", \"st53\", \"st99\", \"income\", \"treat\", \"ppvtr.36\")\n\nurl <- \"https://raw.githubusercontent.com/avehtari/ROS-Examples/master/Childcare/data/cc2.csv\"\n\nd <- read_csv(url) |> \n  select(var_names) |> \n  mutate(across(matches(\"st\\\\d{2}\"), as.integer))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 4381 Columns: 64\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): sample\ndbl (62): momage, momrace, b.marr, momed, work.dur, prenatal, cig, booze, se...\nlgl  (1): st99\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using an external vector in selections was deprecated in tidyselect 1.1.0.\nℹ Please use `all_of()` or `any_of()` instead.\n  # Was:\n  data %>% select(var_names)\n\n  # Now:\n  data %>% select(all_of(var_names))\n\nSee <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.\n```\n\n\n:::\n\n```{.r .cell-code}\nglimpse(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 4,381\nColumns: 32\n$ momage   <dbl> 33, 22, 13, 25, 19, 19, 26, 20, 23, 28, 32, 23, 29, 18, 25, 1…\n$ b.marr   <dbl> 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1…\n$ momed    <dbl> 4, 1, 1, 4, 1, 2, 1, 1, 2, 2, 1, 2, 1, 1, 4, 1, 1, 1, 2, 1, 3…\n$ work.dur <dbl> 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1…\n$ prenatal <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ cig      <dbl> 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1…\n$ booze    <dbl> 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ sex      <dbl> 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1…\n$ first    <dbl> 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1…\n$ bw       <dbl> 1559, 2240, 1900, 1550, 2270, 1550, 2330, 2410, 1776, 2140, 2…\n$ bwg      <dbl> 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0…\n$ preterm  <dbl> 10, 3, 6, 8, 5, 4, 9, 3, 6, 5, 5, 7, 6, 10, 8, 6, 7, 6, 6, 6,…\n$ black    <dbl> 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0…\n$ hispanic <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ white    <dbl> 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1…\n$ lths     <dbl> 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0…\n$ hs       <dbl> 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0…\n$ ltcoll   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1…\n$ college  <dbl> 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…\n$ dayskidh <dbl> 31, 4, 9, 50, 4, 13, 8, 6, 30, 2, 3, 27, 13, 24, 71, 1, 6, 4,…\n$ st5      <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ st9      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st12     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st25     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st36     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st42     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st48     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st53     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ st99     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ income   <dbl> 42500.0000, 5000.0000, 12500.0000, 42500.0000, 5000.0000, 125…\n$ treat    <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ ppvtr.36 <dbl> 111.00000, 81.00000, 92.00000, 103.00000, 81.00000, 94.00000,…\n```\n\n\n:::\n:::\n\n\n### Exercise\n\n@gelman2020 say: *We excluded the most severely low-birth-weight children (those at or below 1500 grams) from the sample because they are so different from the comparison sample.*\n\n::: callout-note\nIn your own words.\n\n-   Why did they decide to exclude these children? What problem could we encounter by not omitting them?\n\n-   Would *you* have excluded them from the dataset?[^week08-2] Why?\n:::\n\n[^week08-2]: I wouldn't!\n\n### Exercise\n\n::: callout-note\nLook at the variables.\n\nWhich ones are you planning to use for covariate balancing? Justify your answer, but *keep it short!*\n:::\n\n::: callout-tip\nNote.\n\nDepending on what you end up doing you might need to reconsider this answer.\n:::\n\n### Exercise\n\n*Note. This exercise should take most of your time. Basically, you have to re-do the kind of analysis we did for last week's homework and at the beginning of this week with Steve ([here](https://github.com/vaiseys/soc-stats-2/blob/main/demos/week-08.R)).*\n\n::: callout-note\nUse the `WeightIt` package and try to achieve balance before estimating the ATT for the effect of this child care program.\n\nYou will have to do this three separate times, using the following:\n\n-   Propensity Scores\n\n-   CBPS\n\n-   Entropy Balancing\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}